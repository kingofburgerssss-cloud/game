<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glowing Lava Cave</title>
<style>
  body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
  canvas { display: block; }

  #achievements {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 120px;
    height: 40px;
    background-color: #111;
    color: #000;
    text-align: center;
    line-height: 40px;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s;
    user-select: none;
  }
  #achievements.unlocked {
    background-color: #444;
    color: #fff;
  }

  #notification {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background-color: rgba(255,140,0,0.9);
    color: #fff;
    padding: 10px 15px;
    border-radius: 5px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
  }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="achievements">Achievements</div>
<div id="notification">User found Iron!</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;

const pixelSize = 5;
let cols = Math.floor(width / pixelSize);
let rows = Math.floor(height / pixelSize);

let meltGrid = [];
let smokeParticles = [];
let foundIron = false;

const achievementsBtn = document.getElementById('achievements');
const notification = document.getElementById('notification');

function initGrid() {
  meltGrid = [];
  for (let y = 0; y < rows; y++) {
    meltGrid[y] = [];
    for (let x = 0; x < cols; x++) {
      let isIron = Math.random() < 0.005; // 0.5% chance
      meltGrid[y][x] = { color: '#000', melting: false, offset: 0, speed: 0, isIron };
    }
  }
}
initGrid();

function showNotification() {
  notification.style.opacity = 1;
  setTimeout(() => { notification.style.opacity = 0; }, 2000);
}

function createSmokeAtPixel(x, y) {
  smokeParticles.push({
    x: x*pixelSize + pixelSize/2 + (Math.random()-0.5)*pixelSize,
    y: y*pixelSize + pixelSize/2 + (Math.random()-0.5)*pixelSize,
    alpha: 1,
    radius: 2 + Math.random()*2,
    speedY: 0.3 + Math.random()*0.3
  });
}

function meltPixel(px, py) {
  if (px < 0 || px >= cols || py < 0 || py >= rows) return;
  const cell = meltGrid[py][px];
  if (cell.melting) return;

  cell.melting = true;
  cell.color = 'orange';
  cell.offset = 0;
  cell.speed = 0.3 + Math.random()*0.5;

  createSmokeAtPixel(px, py);

  const interval = setInterval(() => {
    cell.offset += cell.speed;

    if (cell.offset >= pixelSize) {
      if (py+1 < rows) {
        const below = meltGrid[py+1][px];
        if (!below.melting) {
          [cell.color, below.color] = [below.color, cell.color];
          [cell.offset, below.offset] = [0, cell.offset - pixelSize];
          cell.melting = false;
          below.melting = true;
          clearInterval(interval);
          meltPixel(px, py+1);
          return;
        }
      }
      if (cell.isIron && !foundIron) {
        foundIron = true;
        achievementsBtn.classList.add('unlocked');
        showNotification();
        cell.color = '#8b5a2b';
      } else {
        cell.color = cell.isIron ? '#8b5a2b' : '#000';
      }
      cell.melting = false;
      clearInterval(interval);
    }
  }, 16);
}

function drawGrid() {
  ctx.clearRect(0, 0, width, height);

  // black background
  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, width, height);

  // draw pixels with real glow
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const cell = meltGrid[y][x];
      if (cell.melting) {
        ctx.shadowColor = 'orange';
        ctx.shadowBlur = 30;
        ctx.fillStyle = 'orange';
        ctx.fillRect(x*pixelSize, y*pixelSize + cell.offset, pixelSize, pixelSize);
        ctx.shadowBlur = 0;
      } else {
        ctx.fillStyle = cell.color;
        ctx.fillRect(x*pixelSize, y*pixelSize + cell.offset, pixelSize, pixelSize);
      }
    }
  }

  // smoke
  for (let i = smokeParticles.length-1; i>=0; i--) {
    const p = smokeParticles[i];
    ctx.fillStyle = `rgba(200,200,200,${p.alpha})`;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
    ctx.fill();
    p.y -= p.speedY;
    p.alpha -= 0.01;
    if (p.alpha <= 0) smokeParticles.splice(i,1);
  }

  // vignette
  const gradient = ctx.createRadialGradient(width/2, height/2, Math.max(width,height)/6, width/2, height/2, Math.max(width,height)/1.2);
  gradient.addColorStop(0, 'rgba(0,0,0,0)');
  gradient.addColorStop(1, 'rgba(0,0,0,0.95)');
  ctx.fillStyle = gradient;
  ctx.fillRect(0,0,width,height);
}

// mouse melt
let mouseDown = false;
canvas.addEventListener('mousedown', e => { mouseDown = true; meltAtMouse(e); });
canvas.addEventListener('mouseup', e => mouseDown = false);
canvas.addEventListener('mousemove', e => { if(mouseDown) meltAtMouse(e); });

function meltAtMouse(e) {
  const x = Math.floor(e.clientX / pixelSize);
  const y = Math.floor(e.clientY / pixelSize);
  for (let dx=-1; dx<=1; dx++) {
    for (let dy=-1; dy<=1; dy++) {
      meltPixel(x+dx, y+dy);
    }
  }
}

function animate() {
  drawGrid();
  requestAnimationFrame(animate);
}
animate();

// resize
window.addEventListener('resize', () => {
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
  cols = Math.floor(width / pixelSize);
  rows = Math.floor(height / pixelSize);
  initGrid();
});
</script>
</body>
</html>
